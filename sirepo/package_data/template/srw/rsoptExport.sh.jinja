#!/bin/bash
{% for d in [runDir, 'beams', 'data_files', 'datasets', 'parameters'] %}
if [ -d "{{ d }}" ]; then
    rm -rf --preserve-root "{{ d }}"
fi
{% endfor %}
run_rsopt="rsopt sample configuration '{{ ymlFileName }}'"
echo Running $run_rsopt...
eval "$run_rsopt" > "{{ outFileName }}" 2>&1
if [ $? -eq 0 ]
then
    run_py="python '{{ pyFileName }}' rsopt_run '{{ fileBase }}.npy'"
    read -p "Continue? (** will run SRW {{ totalSamples }} times **)? (Y/N): " confirm
    if [[ $confirm == [yY] ]]; then
        echo Running SRW...
        if eval "$run_py"; then
            echo Results are in datasets/results.h5
        else
            echo "ERROR: SRW failed with return code $?"
        fi
    else
        echo "NOTE: to run SRW with generated data, use
        $run_py"
    fi
else
    echo "ERROR: rsopt failed with return code $?, see {{ outFileName }}"
    exit 99
fi
